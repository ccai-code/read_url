# Jenkinséƒ¨ç½²å¤±è´¥è§£å†³æ–¹æ¡ˆ

## ğŸš¨ é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯**: `fatal: destination path '.' already exists and is not an empty directory.`

**æ ¹æœ¬åŸå› **: Jenkinså·¥ä½œç›®å½• `/root/workspace` å­˜åœ¨æ®‹ç•™æ–‡ä»¶ï¼Œå¯¼è‡´Gitæ— æ³•å…‹éš†åˆ°éç©ºç›®å½•ã€‚

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šä¿®æ”¹ç°æœ‰Jenkinsæµæ°´çº¿ï¼ˆæ¨èï¼‰

åœ¨ç°æœ‰çš„Gitå…‹éš†å‘½ä»¤å‰æ·»åŠ æ¸…ç†æ­¥éª¤ï¼š

```bash
# åŸæ¥çš„å‘½ä»¤
git clone ****** .

# ä¿®æ”¹ä¸º
rm -rf ./* 2>/dev/null || true
rm -rf .git 2>/dev/null || true
rm -rf .[^.]* 2>/dev/null || true
git clone ****** .
```

### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨æä¾›çš„ä¿®å¤è„šæœ¬

1. å°† `jenkins-git-fix.sh` è„šæœ¬ä¸Šä¼ åˆ°JenkinsæœåŠ¡å™¨
2. åœ¨Jenkinsæµæ°´çº¿ä¸­è°ƒç”¨è„šæœ¬ï¼š

```bash
# åœ¨"æ£€å‡ºä»£ç ä»“åº“"é˜¶æ®µæ›¿æ¢ä¸ºï¼š
bash /path/to/jenkins-git-fix.sh
```

### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨å®Œæ•´çš„Jenkinsfile

å°†é¡¹ç›®æ ¹ç›®å½•çš„ `Jenkinsfile` é…ç½®åº”ç”¨åˆ°Jenkinsä»»åŠ¡ä¸­ï¼Œè¯¥é…ç½®åŒ…å«ï¼š

- âœ… å·¥ä½œç©ºé—´æ¸…ç†é˜¶æ®µ
- âœ… å®‰å…¨çš„Gitå…‹éš†
- âœ… ä»£ç éªŒè¯
- âœ… Dockeræ„å»º
- âœ… TCRæ¨é€
- âœ… æ„å»ºäº§ç‰©æ¸…ç†

## ğŸ“‹ å®æ–½æ­¥éª¤

### ç«‹å³ä¿®å¤ï¼ˆæœ€ç®€å•ï¼‰

1. ç™»å½•Jenkinsç®¡ç†ç•Œé¢
2. æ‰¾åˆ° `get-url` é¡¹ç›®çš„æµæ°´çº¿é…ç½®
3. åœ¨"æ£€å‡ºä»£ç ä»“åº“"é˜¶æ®µçš„Gitå…‹éš†å‘½ä»¤å‰æ·»åŠ ï¼š

```bash
echo "æ¸…ç†å·¥ä½œç›®å½•..."
rm -rf ./* 2>/dev/null || true
rm -rf .git 2>/dev/null || true
rm -rf .[^.]* 2>/dev/null || true
echo "å·¥ä½œç›®å½•å·²æ¸…ç†"
```

4. ä¿å­˜é…ç½®å¹¶é‡æ–°è§¦å‘æ„å»º

### é•¿æœŸä¼˜åŒ–

1. **å¯ç”¨Jenkinsæ¸…ç†é€‰é¡¹**ï¼š
   - åœ¨é¡¹ç›®é…ç½®ä¸­å¯ç”¨ "Delete workspace before build starts"
   - å¯ç”¨ "Clean before checkout"

2. **ä½¿ç”¨æä¾›çš„Jenkinsfile**ï¼š
   - å°†é¡¹ç›®åˆ‡æ¢ä¸ºPipelineé¡¹ç›®
   - ä½¿ç”¨ä»“åº“ä¸­çš„ `Jenkinsfile`

## ğŸ” éªŒè¯æ­¥éª¤

ä¿®å¤åï¼Œé‡æ–°è§¦å‘éƒ¨ç½²ï¼Œåº”è¯¥çœ‹åˆ°ï¼š

1. âœ… å·¥ä½œç©ºé—´æ¸…ç†æˆåŠŸ
2. âœ… Gitå…‹éš†æˆåŠŸ
3. âœ… Dockerfileå†™å…¥æˆåŠŸ
4. âœ… Dockeré•œåƒæ„å»ºæˆåŠŸ
5. âœ… é•œåƒæ¨é€åˆ°TCRæˆåŠŸ

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### æ¸…ç†å‘½ä»¤è¯´æ˜

```bash
rm -rf ./* 2>/dev/null || true     # åˆ é™¤æ‰€æœ‰å¯è§æ–‡ä»¶å’Œç›®å½•
rm -rf .git 2>/dev/null || true    # åˆ é™¤Gitä»“åº“ç›®å½•
rm -rf .[^.]* 2>/dev/null || true  # åˆ é™¤éšè—æ–‡ä»¶ï¼ˆæ’é™¤. å’Œ ..ï¼‰
```

- `2>/dev/null` : å¿½ç•¥é”™è¯¯è¾“å‡º
- `|| true` : ç¡®ä¿å‘½ä»¤ä¸ä¼šå› ä¸ºæ–‡ä»¶ä¸å­˜åœ¨è€Œå¤±è´¥
- `set +e` / `set -e` : æ§åˆ¶è„šæœ¬çš„é”™è¯¯å¤„ç†è¡Œä¸º

### å®‰å…¨æ€§è€ƒè™‘

- âœ… åªæ¸…ç†å½“å‰å·¥ä½œç›®å½•
- âœ… ä¸å½±å“ç³»ç»Ÿæ–‡ä»¶
- âœ… ä¿ç•™Jenkinsé…ç½®
- âœ… æ”¯æŒå¹¶å‘æ„å»º

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®å¤åçš„æ„å»ºæ—¥å¿—åº”è¯¥æ˜¾ç¤ºï¼š

```
2025-08-05 XX:XX:XX Pipeline { (æ£€å‡ºä»£ç ä»“åº“)
2025-08-05 XX:XX:XX + echo "æ¸…ç†å·¥ä½œç›®å½•..."
2025-08-05 XX:XX:XX æ¸…ç†å·¥ä½œç›®å½•...
2025-08-05 XX:XX:XX + rm -rf ./* 2>/dev/null || true
2025-08-05 XX:XX:XX + rm -rf .git 2>/dev/null || true
2025-08-05 XX:XX:XX + rm -rf .[^.]* 2>/dev/null || true
2025-08-05 XX:XX:XX + echo "å·¥ä½œç›®å½•å·²æ¸…ç†"
2025-08-05 XX:XX:XX å·¥ä½œç›®å½•å·²æ¸…ç†
2025-08-05 XX:XX:XX + git clone ****** .
2025-08-05 XX:XX:XX Cloning into '.'...
2025-08-05 XX:XX:XX Pipeline }
2025-08-05 XX:XX:XX Pipeline // stage
```

## ğŸ“ æ”¯æŒ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æ£€æŸ¥ï¼š

1. Jenkinsç”¨æˆ·æƒé™
2. å·¥ä½œç›®å½•ç£ç›˜ç©ºé—´
3. Gitä»“åº“è®¿é—®æƒé™
4. ç½‘ç»œè¿æ¥çŠ¶æ€

---

**åˆ›å»ºæ—¶é—´**: 2025-08-05  
**é€‚ç”¨ç‰ˆæœ¬**: Jenkins 2.x  
**æµ‹è¯•çŠ¶æ€**: âœ… å·²éªŒè¯